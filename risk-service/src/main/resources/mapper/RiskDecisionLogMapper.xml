<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bankcore.risk.repository.RiskDecisionLogMapper">
    <insert id="insert" parameterType="com.bankcore.risk.model.RiskDecisionLog">
        INSERT INTO risk_decision_log(customer_id, payer_account, amount, result, rule_type, rule_id, created_at)
        VALUES (#{customerId}, #{payerAccount}, #{amount}, #{result}, #{ruleType}, #{ruleId}, NOW())
    </insert>

    <select id="sumForCustomerToday" resultType="java.math.BigDecimal">
        SELECT COALESCE(SUM(amount), 0)
        FROM risk_decision_log
        WHERE customer_id = #{customerId}
          AND DATE(created_at) = CURRENT_DATE
          AND result = 'APPROVED'
    </select>

    <select id="findRecent" resultType="com.bankcore.risk.model.RiskDecisionLog">
        SELECT id,
               customer_id,
               payer_account,
               amount,
               result,
               rule_type,
               rule_id,
               created_at
        FROM risk_decision_log
        ORDER BY created_at DESC
        LIMIT #{limit}
    </select>
</mapper>
